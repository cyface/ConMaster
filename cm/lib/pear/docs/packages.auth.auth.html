<HTML
><HEAD
><TITLE
>Auth</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REL="HOME"
TITLE="PEAR Manual"
HREF="index.html"><LINK
REL="UP"
TITLE="Authentication"
HREF="packages.auth.html"><LINK
REL="PREVIOUS"
TITLE="Authentication"
HREF="packages.auth.html"><LINK
REL="NEXT"
TITLE="Auth_HTTP"
HREF="packages.auth.auth_http.html"><META
HTTP-EQUIV="Content-type"
CONTENT="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="refentry"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PEAR Manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="packages.auth.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="packages.auth.auth_http.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="packages.Auth.Auth"
><B
CLASS="classname"
>Auth</B
></A
></H1
><DIV
CLASS="refnamediv"
><A
NAME="AEN3592"
></A
><B
CLASS="classname"
>Auth</B
>&nbsp;--&nbsp;
    PHP based authentication systems.
   </DIV
><DIV
CLASS="refsect1"
><A
NAME="packages.Auth.Auth.tutorial"
></A
><H2
>Usage example</H2
><P
>&#13;    Our goal during this "mini tutorial" is to set up a system that
    secures your site with an easy to use authenticatin mechanism.
   </P
><P
>&#13;    At the top of the site that has to be secured, we place the
    following code snippet:
   </P
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
CLASS="EXAMPLE"
><TR
><TD
><DIV
CLASS="example"
><A
NAME="AEN3600"
></A
><P
><B
>Example 1. Typical usage example for <B
CLASS="classname"
>PEAR::Auth</B
></B
></P
><TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>require_once "Auth/Auth.php";

function loginFunction()
{
    global $PHP_SELF;

    /**
     * Change the HTML output so that it fits to your
     * application.
     */
    echo "&#60;form method=\"post\" action=\"" . $PHP_SELF . "\"&#62;";
    echo "&#60;input type=\"text\" name=\"username\"&#62;";
    echo "&#60;input type=\"password\" name=\"password\"&#62;";
    echo "&#60;input type=\"submit\"&#62;";
    echo "&#60;/form&#62;";
}

$dsn = "mysql://user:password@localhost/database";

$a = new Auth("DB", $dsn, "loginFunction");

$a-&#62;start();

if ($a-&#62;getAuth()) {
    /**
     * The output of your site goes here.
     */
}</PRE
></TD
></TR
></TABLE
></DIV
></TD
></TR
></TABLE
><P
>&#13;    This few lines of code instantiate the authentication system.
    In the following paragraph, we are going to explain every step
    of the above script:
   </P
><P
>&#13;    The first line includes the file from your PEAR directory, that
    contains all the necessary code to run PEAR::Auth. After that
    we define a function, that display the login formular which the
    visitor of your page has to use to enter his login data. You
    can change all the HTML formating in this function.
   </P
><DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>&#13;     You can change all the HTML formatting in the function, but
     you mustn't change the names of the input boxes in the function.
     They have to be "username" and "password".
    </P
></TD
></TR
></TABLE
></DIV
><P
>&#13;    Since we want to use a database to verify the login data against,
    we now create the variable $dsn, that contains a valid DSN string
    that will be used to connect to the database via PEAR::DB. If
    you want to use a different storage container, please see below
    for more information.
   </P
><P
>&#13;    After that we create the authentication object: The first
    parameter defines the name of the storage container. Because
    we want to use a database driven storage container, we pass
    "DB" here. The second parameter is the connection parameter
    for the container driver. We use the previously defined DSN
    string. The third parameter is the name of our function, we
    defined at the beginning of the script, that prints the
    login formular.
   </P
><P
>&#13;    Now our authentication object is inititated and we simply need
    to check if the user is logged in. This is done via the function
    <B
CLASS="function"
>getAuth()</B
>. If it returns true, we can pass
    the content of our page to the user.
   </P
><DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>&#13;     For now one cannot use
     <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>$auth = new Auth(...);</PRE
></TD
></TR
></TABLE
>
     with register_globals=on, because $auth is also the name of
     the session variable, that is used by PEAR::Auth.
    </P
></TD
></TR
></TABLE
></DIV
><P
>&#13;    <TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
CLASS="EXAMPLE"
><TR
><TD
><DIV
CLASS="example"
><A
NAME="AEN3616"
></A
><P
><B
>Example 2. Using optional authentication</B
></P
><TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>require_once "Auth/Auth.php";

function loginFunction()
{
    /**
     * Change the HTML output so that it fits to your
     * application.
     */
    echo "&#60;form method=\"post\" action=\"" . $_SERVER['PHP_SELF'] . "?login=1\"&#62;";
    echo "&#60;input type=\"text\" name=\"username\"&#62;";
    echo "&#60;input type=\"password\" name=\"password\"&#62;";
    echo "&#60;input type=\"submit\"&#62;";
    echo "&#60;/form&#62;";
}

if ($_GET['login'] == 1) {
    $optional = true;
} else {
    $optional = false;
}

$dsn = "mysql://user:password@localhost/database";

$a = new Auth("DB", $dsn, "loginFunction", $optional);

$a-&#62;start();

echo "Everybody can see this text!&#60;br /&#62;";

if (!isset($_GET['login'])) {
    echo "&#60;a href=\"test.php?login=1\"&#62;Click here to log in&#60;/a&#62;\n";
}

if ($a-&#62;getAuth()) {
    echo "One can only see this if he is logged in!";
}</PRE
></TD
></TR
></TABLE
></DIV
></TD
></TR
></TABLE
>
   </P
><P
>&#13;    This is a pretty nice example for the optional login feature: The
    last parameter <TT
CLASS="parameter"
><I
>$optional</I
></TT
> can be either
    true or false. If it is false, the login form is not shown and
    the user, who visits the page, only sees the text "Everybody can
    see this text!". If he clicks on the link above this text, he
    gets the same page but with the GET parameter "login=1". Now he
    can enter his login information in the login formular. If he has
    been successfully logged in, he can then see the text "Everbody
    can see this text!" and the text "One can only see this if he is
    logged in!".
   </P
><P
>&#13;    In the following passages you get to know some detailed
    information about the functions of PEAR::Auth.
   </P
><P
>&#13;    This feature is useful e.g. for portal sites which provide some
    services to all users that visit the sites and some services only
    to users that are logged in.
   </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="packages.Auth.Auth.Auth"
></A
><H2
>Auth::Auth</H2
><DIV
CLASS="funcsynopsis"
><A
NAME="AEN3625"
></A
><P
></P
><P
><CODE
><CODE
CLASS="FUNCDEF"
><B
CLASS="function"
>Auth::Auth</B
></CODE
> (string storageDriver, mixed options, string loginFunction [, bool showLogin])</CODE
></P
><P
></P
></DIV
><P
>&#13;    Constructor for the authencation system. The first parameter is
    the name of the storage driver that should be used. The second
    parameter can either be a string containing some login information
    or an array containing a bunch of options for the storage driver.
   </P
><P
>&#13;    The third parameter is the name of user-defined function that
    prints the login screen. The last parameter can be either true
    or false and defines if the login is optional or not.
   </P
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
CLASS="EXAMPLE"
><TR
><TD
><DIV
CLASS="example"
><A
NAME="AEN3640"
></A
><P
><B
>Example 3. Using different DB parameters</B
></P
><TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>require_once "Auth/Auth.php";

function myOutput($username, $status)
{
    ...  /** See example 1 for the full listing */
}

$params = array(
            "dsn" =&#62; "mysql://martin:test@localhost/auth",
            "table" =&#62; "myAuth",
            "usernamecol" =&#62; "myUserColumn",
            "passwordcol" =&#62; "myPasswordColumn"
            );

$a = new Auth("DB", $params, "myOutput");

$a-&#62;start();

if ($a-&#62;getAuth()) {
    echo "You have been authenticated successfully.";
}</PRE
></TD
></TR
></TABLE
></DIV
></TD
></TR
></TABLE
><P
>&#13;    This example shows you, how you can specifiy alternative
    names for the database table and the column names. In our
    example, we use the table myAuth, select the username from
    the field myUserColumn and the password from the field
    myPasswordColumn. The Default values for this fields are
    auth, username and password.
   </P
><P
>&#13;    This feature is necessary if you want to use PEAR::Auth
    with a database layout that is different from the one,
    PEAR::Auth uses by default.
   </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="packages.Auth.Auth.start"
></A
><H2
>Auth::start</H2
><DIV
CLASS="funcsynopsis"
><A
NAME="AEN3647"
></A
><P
></P
><P
><CODE
><CODE
CLASS="FUNCDEF"
><B
CLASS="function"
>Auth::start</B
></CODE
> ()</CODE
></P
><P
></P
></DIV
><P
>&#13;    Start the authentication process.
   </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="packages.Auth.Auth.getAuth"
></A
><H2
>Auth::getAuth</H2
><DIV
CLASS="funcsynopsis"
><A
NAME="AEN3655"
></A
><P
></P
><P
><CODE
><CODE
CLASS="FUNCDEF"
>boolean <B
CLASS="function"
>Auth::getAuth</B
></CODE
> ()</CODE
></P
><P
></P
></DIV
><P
>&#13;    Check if the user has been authenticated.
   </P
><P
>&#13;    If the user has already been authenticated, the function returns
    true. Otherwise it returns false.
   </P
><P
>&#13;    For usage example, see <B
CLASS="function"
>Auth::Auth()</B
>.
   </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="packages.Auth.Auth.setSessionname"
></A
><H2
>Auth::setSessionname</H2
><DIV
CLASS="funcsynopsis"
><A
NAME="AEN3666"
></A
><P
></P
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void <B
CLASS="function"
>setSessionname</B
></CODE
> (string name)</CODE
></P
><P
></P
></DIV
><P
>&#13;    This function can set a customized name for the session that is
    created during the login process. The default for this session
    name is "PHPSESSID". You have to use <B
CLASS="function"
>setSessionname()</B
>,
    if you are running two or more different applications with Auth
    on the same domain. If you don't use this function, a user who has
    once logged in at one of the applications can also use the other
    applications without logging in again!
   </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="packages.Auth.Auth.setExpire"
></A
><H2
>Auth::setExpire</H2
><DIV
CLASS="funcsynopsis"
><A
NAME="AEN3676"
></A
><P
></P
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void <B
CLASS="function"
>setExpire</B
></CODE
> (int time [, bool add])</CODE
></P
><P
></P
></DIV
><P
>&#13;    With this function you can set the maximum expire time that is
    used by auth to a new value. The first parameter <TT
CLASS="parameter"
><I
>$time
    </I
></TT
> defines the number of seconds. If the second
    parameter <TT
CLASS="parameter"
><I
>$add</I
></TT
> is true, the first parameter
    is added on the existing expire time. If it is false (which is
    also the default value), the first parameter replaces the existing
    time.
   </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="packages.Auth.Auth.getStatus"
></A
><H2
>Auth::getStatus</H2
><DIV
CLASS="funcsynopsis"
><A
NAME="AEN3690"
></A
><P
></P
><P
><CODE
><CODE
CLASS="FUNCDEF"
>string <B
CLASS="function"
>getStatus</B
></CODE
> ()</CODE
></P
><P
></P
></DIV
><P
>&#13;    This function returns the current status of PEAR::Auth. The return
    values are constants that are defined by PEAR Auth. <TT
CLASS="constant"
><B
>&#13;    AUTH_IDLED</B
></TT
> means that the maximum idle time has been
    reached. <TT
CLASS="constant"
><B
>AUTH_EXPIRED</B
></TT
> means that the maximum
    expire time has been reached and <TT
CLASS="constant"
><B
>AUTH_WRONG_LOGIN
    </B
></TT
> means that the user has entered wrong login data in
    the login form.
   </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="packages.auth.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="packages.auth.auth_http.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Authentication</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="packages.auth.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><B
CLASS="classname"
>Auth_HTTP</B
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>